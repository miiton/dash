---
- hosts: 127.0.0.1
  connection: local

  vars:
    dev_env_dir: /usr/local/dev-env

  tasks:

    - name: Check Sudo Password
      command: ls
      become: yes
      become_method: sudo

    - name: Update Homebrew
      homebrew: update_homebrew=yes

    - name: Tap Caskroom
      homebrew_tap: tap=caskroom/cask

    - name: Tap Caskroom/Versions
      homebrew_tap: tap=caskroom/versions

    - name: Tap completions
      homebrew_tap: tap=homebrew/completions

    - name: Install Caskroom
      homebrew: name=brew-cask state=latest

    - name: Change user shell to zsh
      command: dscl . -create /Users/$USER UserShell /bin/zsh
      become: yes
      become_method: sudo

    - name: Install brew apps
      homebrew:
        name: "{{ item }}"
        state: latest
      with_items:
        - zsh-completion
        - docker-completion
        - docker-compose-completion
        - vagrant-completion
        - pip-completion
        - neovim/neovim/neovim
        - go
        - pyenv
        - https://raw.githubusercontent.com/choppsv1/homebrew-term24/master/tmux.rb
        - docker-machine
        - docker-compose
        - mobile-shell

    - name: Install cask apps
      homebrew_cask:
        name: "{{ item }}"
        state: latest
      with_items:
        - the-unarchiver
        - sketch
        - sketch-tool
        - sketch-toolbox
        - google-chrome
        - firefox
        - dropbox
        - slack
        - skitch
        - iterm2-nightly
        - docker
        - avast
      environment:
        HOMEBREW_CASK_OPTS: --appdir=/Applications

    - name: Install Pythons
      command: pyenv install "{{ item }}"
      with_items:
        - 2.7.11
        - 3.5.1
      environment:
        PYENV_ROOT="$HOME/.pyenv"
